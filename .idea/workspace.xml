<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="ebf40ef6-dba9-436a-9599-74b1c3db166c" name="Changes" comment="">
      <change afterPath="$PROJECT_DIR$/.gitignore" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/.idea/inspectionProfiles/profiles_settings.xml" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/.idea/mbti_project.iml" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/.idea/misc.xml" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/.idea/modules.xml" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/.idea/vcs.xml" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/app.py" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/db.py" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/static/style.css" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/activity.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/activity_manage.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/base.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/base_no_nav.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/club.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/club_manage.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/club_status.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/course_detail.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/dashboard.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/leader_dashboard.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/login.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/my_clubs.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/profile.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/profile_setup.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/staff_home.html" afterDir="false" />
      <change afterPath="$PROJECT_DIR$/templates/timetable.html" afterDir="false" />
    </list>
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="FileTemplateManagerImpl">
    <option name="RECENT_TEMPLATES">
      <list>
        <option value="Python Script" />
        <option value="JavaScript File" />
        <option value="CSS File" />
        <option value="HTML File" />
      </list>
    </option>
  </component>
  <component name="FlaskConsoleOptions" custom-start-script="import sys; print('Python %s on %s' % (sys.version, sys.platform)); sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo, NoAppException&#10;for module in [&quot;main.py&quot;, &quot;wsgi.py&quot;, &quot;app.py&quot;]:&#10;    try: locals().update(ScriptInfo(app_import_path=module, create_app=None).load_app().make_shell_context()); print(&quot;\nFlask App: %s&quot; % app.import_name); break&#10;    except NoAppException: pass">
    <envs>
      <env key="FLASK_APP" value="app" />
    </envs>
    <option name="myCustomStartScript" value="import sys; print('Python %s on %s' % (sys.version, sys.platform)); sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo, NoAppException&#10;for module in [&quot;main.py&quot;, &quot;wsgi.py&quot;, &quot;app.py&quot;]:&#10;    try: locals().update(ScriptInfo(app_import_path=module, create_app=None).load_app().make_shell_context()); print(&quot;\nFlask App: %s&quot; % app.import_name); break&#10;    except NoAppException: pass" />
    <option name="myEnvs">
      <map>
        <entry key="FLASK_APP" value="app" />
      </map>
    </option>
  </component>
  <component name="Git.Settings">
    <option name="RECENT_GIT_ROOT_PATH" value="$PROJECT_DIR$" />
  </component>
  <component name="ProjectColorInfo">{
  &quot;associatedIndex&quot;: 4
}</component>
  <component name="ProjectId" id="35au8s4AIJQhVvesSL7d6c9CnrX" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent">{
  &quot;keyToString&quot;: {
    &quot;DefaultHtmlFileTemplate&quot;: &quot;HTML File&quot;,
    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,
    &quot;Python.app.executor&quot;: &quot;Run&quot;,
    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
    &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,
    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,
    &quot;git-widget-placeholder&quot;: &quot;master&quot;,
    &quot;list.type.of.created.stylesheet&quot;: &quot;CSS&quot;,
    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,
    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,
    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,
    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,
    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,
    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;
  }
}</component>
  <component name="RunAnythingCache">
    <option name="myCommands">
      <command value="from flask import Flask, render_template, request, redirect, session from db import get_connection from datetime import datetime  app = Flask(__name__) app.secret_key = &quot;super_secret_123&quot;   # ============================================================================ # HOME # ============================================================================ @app.route(&quot;/&quot;) def home():     return redirect(&quot;/login&quot;)   # ============================================================================ # LOGIN # ============================================================================ @app.route(&quot;/login&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;]) def login():     error = None      if request.method == &quot;POST&quot;:         user_id = request.form.get(&quot;user_id&quot;)         password = request.form.get(&quot;password&quot;)          conn = get_connection()         cur = conn.cursor()          cur.execute(&quot;&quot;&quot;             SELECT student_id, name, mbti, nickname, year_level             FROM Student             WHERE student_id=%s                AND password=%s               AND is_deleted=FALSE         &quot;&quot;&quot;, (user_id, password))          row = cur.fetchone()         cur.close()         conn.close()          if row:             session[&quot;user_id&quot;] = row[0]             session[&quot;user_name&quot;] = row[1]              nickname = row[3]             year_level = row[4]              # 첫 로그인 → profile-setup 이동             if not nickname or not year_level:                 return redirect(&quot;/profile-setup&quot;)              return redirect(&quot;/dashboard&quot;)          else:             error = &quot;Invalid login information&quot;      return render_template(&quot;login.html&quot;, error=error)   # ============================================================================ # PROFILE SETUP (최초 로그인) # ============================================================================ @app.route(&quot;/profile-setup&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;]) def profile_setup():     if &quot;user_id&quot; not in session:         return redirect(&quot;/login&quot;)      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;SELECT major_id, major_name FROM Major ORDER BY major_name&quot;)     majors = cur.fetchall()      if request.method == &quot;POST&quot;:         nickname = request.form.get(&quot;nickname&quot;)         major_id = request.form.get(&quot;major&quot;)         year_level = request.form.get(&quot;year_level&quot;)         mbti = request.form.get(&quot;mbti&quot;)         preferred_time = request.form.get(&quot;preferred_time&quot;)          cur.execute(&quot;&quot;&quot;             UPDATE Student             SET nickname=%s,                 major_id=%s,                 year_level=%s,                 mbti=%s,                 preferred_time=%s,                 updated_at=NOW()             WHERE student_id=%s         &quot;&quot;&quot;, (             nickname, major_id, year_level,             mbti, preferred_time, session[&quot;user_id&quot;]         ))          conn.commit()         cur.close()         conn.close()          return redirect(&quot;/dashboard&quot;)      cur.close()     conn.close()      return render_template(&quot;profile_setup.html&quot;, majors=majars)   # ============================================================================ # DASHBOARD # ============================================================================ @app.route(&quot;/dashboard&quot;) def dashboard():     if &quot;user_id&quot; not in session:         return redirect(&quot;/login&quot;)      student = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      # 학생 정보     cur.execute(&quot;&quot;&quot;         SELECT mbti, major_id, year_level         FROM Student         WHERE student_id=%s     &quot;&quot;&quot;, (student,))     mbti, major_id, year_level = cur.fetchone()      # ------------------------------------------------------     # Major 추천     # ------------------------------------------------------     cur.execute(&quot;&quot;&quot;         SELECT l.lecture_id, l.name, l.day, l.start_time, l.end_time,                ml.category, l.description, COALESCE(r.score, 0),                l.style_profile         FROM Lecture l         JOIN MajorLecture ml ON ml.lecture_id = l.lecture_id         LEFT JOIN MBTIRecommendation r             ON r.item_id = l.lecture_id            AND (r.mbti=%s OR r.student_id=%s)         WHERE ml.major_id = %s     &quot;&quot;&quot;, (mbti, student, major_id))      major_rows = cur.fetchall()      # 점수 계산 함수     def compute_final_score(mbti_score, style_vec):         if style_vec is None:             return mbti_score         vec = [int(x) for x in style_vec.split(&quot;,&quot;)]         return mbti_score + sum(vec)      major_by_year = {}      for row in major_rows:         lec_id, name, day, st, et, cat, desc, mbti_score, style_vec = row         final_score = compute_final_score(mbti_score, style_vec)          major_by_year.setdefault(cat, []).append({             &quot;lecture_id&quot;: lec_id,             &quot;name&quot;: name,             &quot;day&quot;: day,             &quot;start&quot;: st,             &quot;end&quot;: et,             &quot;description&quot;: desc,             &quot;score&quot;: final_score         })      for cat in major_by_year:         major_by_year[cat].sort(key=lambda x: x[&quot;score&quot;], reverse=True)      # ------------------------------------------------------     # Minor 추천     # ------------------------------------------------------     cur.execute(&quot;&quot;&quot;         SELECT l.lecture_id, l.name, l.day, l.start_time, l.end_time,                ml.category, l.description, COALESCE(r.score, 0),                ml.minor_id, l.style_profile         FROM Lecture l         JOIN MinorLecture ml ON ml.lecture_id = l.lecture_id         LEFT JOIN MBTIRecommendation r             ON r.item_id = l.lecture_id            AND (r.mbti=%s OR r.student_id=%s)     &quot;&quot;&quot;, (mbti, student))      minor_rows = cur.fetchall()      # Minor 리스트     cur.execute(&quot;SELECT minor_id, minor_name FROM Minor ORDER BY minor_id&quot;)     minor_list = cur.fetchall()     id_to_minor = {m[0]: m[1] for m in minor_list}      minor_filtered = {m[1]: [] for m in minor_list}      for row in minor_rows:         lec_id, name, day, st, et, cat, desc, mbti_score, m_id, style_vec = row         final_score = compute_final_score(mbti_score, style_vec)          minor_name = id_to_minor.get(m_id)         if minor_name:             minor_filtered[minor_name].append({                 &quot;lecture_id&quot;: lec_id,                 &quot;name&quot;: name,                 &quot;day&quot;: day,                 &quot;start&quot;: st,                 &quot;end&quot;: et,                 &quot;description&quot;: desc,                 &quot;score&quot;: final_score             })      for m in minor_filtered:         minor_filtered[m].sort(key=lambda x: x[&quot;score&quot;], reverse=True)      # ------------------------------------------------------     # 좋아요한 강의     # ------------------------------------------------------     cur.execute(&quot;&quot;&quot;         SELECT l.lecture_id, l.name, l.day, l.start_time, l.end_time,                l.description, COALESCE(r.score, 0), l.style_profile         FROM Lecture l         JOIN Preference p ON p.item_id = l.lecture_id         LEFT JOIN MBTIRecommendation r             ON r.item_id = l.lecture_id            AND (r.mbti=%s OR r.student_id=%s)         WHERE p.student_id=%s AND p.is_liked=TRUE     &quot;&quot;&quot;, (mbti, student, student))      liked_rows = cur.fetchall()      liked_courses = []     for row in liked_rows:         lec_id, name, day, st, et, desc, mbti_score, style_vec = row         final_score = compute_final_score(mbti_score, style_vec)          liked_courses.append({             &quot;lecture_id&quot;: lec_id,             &quot;name&quot;: name,             &quot;day&quot;: day,             &quot;start&quot;: st,             &quot;end&quot;: et,             &quot;description&quot;: desc,             &quot;score&quot;: final_score         })      liked_courses.sort(key=lambda x: x[&quot;score&quot;], reverse=True)      cur.close()     conn.close()      return render_template(         &quot;dashboard.html&quot;,         major_by_year=major_by_year,         minor_filtered=minor_filtered,         minor_list=minor_list,         liked_courses=liked_courses     )   # ============================================================================ # LIKE TOGGLE # ============================================================================ @app.post(&quot;/toggle-like&quot;) def toggle_like():     student_id = session[&quot;user_id&quot;]     lecture_id = request.form.get(&quot;lecture_id&quot;)      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         SELECT is_liked         FROM Preference         WHERE student_id=%s AND item_type='Lecture' AND item_id=%s     &quot;&quot;&quot;, (student_id, lecture_id))      row = cur.fetchone()      if row:         new_val = not row[0]         cur.execute(&quot;&quot;&quot;             UPDATE Preference             SET is_liked=%s, updated_at=NOW()             WHERE student_id=%s AND item_type='Lecture' AND item_id=%s         &quot;&quot;&quot;, (new_val, student_id, lecture_id))      else:         cur.execute(&quot;&quot;&quot;             INSERT INTO Preference (student_id, item_type, item_id, is_liked)             VALUES (%s, 'Lecture', %s, TRUE)         &quot;&quot;&quot;, (student_id, lecture_id))      conn.commit()     cur.close()     conn.close()      return redirect(&quot;/dashboard&quot;)   # ============================================================================ # COURSE DETAIL # ============================================================================ @app.route(&quot;/course/&lt;int:lecture_id&gt;&quot;) def course_detail(lecture_id):     conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         SELECT name, day, start_time, end_time, category,                teaching_style, style_profile, description         FROM Lecture         WHERE lecture_id=%s     &quot;&quot;&quot;, (lecture_id,))      row = cur.fetchone()     cur.close()     conn.close()      if not row:         return &quot;Lecture not found&quot;, 404      name, day, st, et, cat, tstyle, sprofile, desc = row      return render_template(&quot;course_detail.html&quot;,         name=name, day=day, start=st, end=et,         category=cat, teaching_style=tstyle,         style_profile=sprofile, description=desc     )   # ============================================================================ # TIMETABLE # ============================================================================ def to_time(v):     return datetime.strptime(str(v), &quot;%H:%M:%S&quot;).time()   @app.route(&quot;/generate-timetable&quot;) def generate_timetable():     student = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         SELECT l.lecture_id, l.name, l.day, l.start_time,                l.end_time, COALESCE(r.score, 0)         FROM Lecture l         LEFT JOIN MBTIRecommendation r             ON r.item_id = l.lecture_id            AND (r.student_id=%s OR r.mbti IN (                 SELECT mbti FROM Student WHERE student_id=%s            ))         ORDER BY score DESC     &quot;&quot;&quot;, (student, student))      lectures = cur.fetchall()     cur.close()     conn.close()      timetable = {}      for lec_id, name, day, st, et, score in lectures:         st = to_time(st)         et = to_time(et)          if day not in timetable:             timetable[day] = []          # 시간 충돌 체크         clash = any(not (et &lt;= s[&quot;start&quot;] or st &gt;= s[&quot;end&quot;])                     for s in timetable[day])          if clash:             continue          timetable[day].append({             &quot;name&quot;: name,             &quot;start&quot;: st,             &quot;end&quot;: et,             &quot;score&quot;: score         })      return render_template(&quot;timetable.html&quot;, timetable=timetable)   # ============================================================================ # CLUB RECOMMENDATION GENERATE # ============================================================================ @app.route(&quot;/generate-club-recommendation&quot;) def generate_club_recommendation():     MBTI_CLUB_STYLE = {         &quot;INTJ&quot;: {&quot;학술&quot;: 5, &quot;스포츠&quot;: 2, &quot;예술&quot;: 3},         &quot;INTP&quot;: {&quot;학술&quot;: 5, &quot;스포츠&quot;: 2, &quot;예술&quot;: 3},         &quot;INFJ&quot;: {&quot;학술&quot;: 4, &quot;스포츠&quot;: 2, &quot;예술&quot;: 4},         &quot;INFP&quot;: {&quot;학술&quot;: 3, &quot;스포츠&quot;: 2, &quot;예술&quot;: 5},         &quot;ISTJ&quot;: {&quot;학술&quot;: 5, &quot;스포츠&quot;: 2, &quot;예술&quot;: 2},         &quot;ISTP&quot;: {&quot;학술&quot;: 3, &quot;스포츠&quot;: 5, &quot;예술&quot;: 2},         &quot;ISFJ&quot;: {&quot;학술&quot;: 3, &quot;스포츠&quot;: 2, &quot;예술&quot;: 4},         &quot;ISFP&quot;: {&quot;학술&quot;: 2, &quot;스포츠&quot;: 3, &quot;예술&quot;: 5},         &quot;ENTJ&quot;: {&quot;학술&quot;: 4, &quot;스포츠&quot;: 4, &quot;예술&quot;: 3},         &quot;ENTP&quot;: {&quot;학술&quot;: 3, &quot;스포츠&quot;: 4, &quot;예술&quot;: 4},         &quot;ENFJ&quot;: {&quot;학술&quot;: 3, &quot;스포츠&quot;: 2, &quot;예술&quot;: 5},         &quot;ENFP&quot;: {&quot;학술&quot;: 2, &quot;스포츠&quot;: 3, &quot;예술&quot;: 5},         &quot;ESTJ&quot;: {&quot;학술&quot;: 4, &quot;스포츠&quot;: 5, &quot;예술&quot;: 2},         &quot;ESTP&quot;: {&quot;학술&quot;: 2, &quot;스포츠&quot;: 5, &quot;예술&quot;: 3},         &quot;ESFJ&quot;: {&quot;학술&quot;: 2, &quot;스포츠&quot;: 3, &quot;예술&quot;: 5},         &quot;ESFP&quot;: {&quot;학술&quot;: 1, &quot;스포츠&quot;: 3, &quot;예술&quot;: 5},     }      def parse_freq(freq_text):         if &quot;주 1회&quot; in freq_text: return 1         if &quot;주 2회&quot; in freq_text: return 2         if &quot;격주&quot; in freq_text: return 1         return 1      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;DELETE FROM ClubRecommendation&quot;)     cur.execute(&quot;SELECT club_id, type, activity_frequency FROM club&quot;)     clubs = cur.fetchall()      for mbti, pref in MBTI_CLUB_STYLE.items():         for club_id, ctype, freq_txt in clubs:             base = pref.get(ctype, 3)             freq_val = parse_freq(freq_txt)              rating = round((base * 2 + freq_val) / 3)             rating = max(1, min(5, rating))              reason = f&quot;{mbti}: {ctype} 선호도 {base}, 활동빈도 {freq_val}&quot;              cur.execute(&quot;&quot;&quot;                 INSERT INTO ClubRecommendation (mbti, club_id, rating, reason)                 VALUES (%s, %s, %s, %s)             &quot;&quot;&quot;, (mbti, club_id, rating, reason))      conn.commit()     cur.close()     conn.close()      return &quot;Club Recommendation ★ 별점 생성 완료!&quot;   # ============================================================================ # CLUB PAGE # ============================================================================ @app.route(&quot;/club&quot;) def club_page():     if &quot;user_id&quot; not in session:         return redirect(&quot;/login&quot;)      user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      # 학생 MBTI     cur.execute(&quot;SELECT mbti FROM student WHERE student_id=%s&quot;, (user_id,))     mbti = cur.fetchone()[0]      # 추천 JOIN     cur.execute(&quot;&quot;&quot;         SELECT c.club_id, c.name, c.type, c.activity_frequency,                c.max_members, c.current_members, c.description,                COALESCE(r.rating, 0), r.reason         FROM club c         LEFT JOIN ClubRecommendation r             ON r.club_id = c.club_id AND r.mbti=%s         ORDER BY rating DESC     &quot;&quot;&quot;, (mbti,))     clubs = cur.fetchall()      # 찜 목록     cur.execute(&quot;SELECT club_id FROM clubfavorite WHERE student_id=%s&quot;, (user_id,))     liked = {row[0] for row in cur.fetchall()}      # 지원 목록     cur.execute(&quot;&quot;&quot;         SELECT club_id         FROM clubmembership         WHERE student_id=%s     &quot;&quot;&quot;, (user_id,))     applied = {row[0] for row in cur.fetchall()}      cur.close()     conn.close()      top3 = clubs[:3]      return render_template(&quot;club.html&quot;,         clubs=clubs, liked_clubs=liked,         applied_clubs=applied, top3=top3     )   # ============================================================================ # CLUB FAVORITE # ============================================================================ @app.post(&quot;/club/favorite/&lt;int:club_id&gt;&quot;) def club_favorite(club_id):     user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         SELECT favorite_id         FROM clubfavorite         WHERE student_id=%s AND club_id=%s     &quot;&quot;&quot;, (user_id, club_id))      row = cur.fetchone()      if row:         cur.execute(&quot;DELETE FROM clubfavorite WHERE favorite_id=%s&quot;, (row[0],))     else:         cur.execute(&quot;&quot;&quot;             INSERT INTO clubfavorite(student_id, club_id)             VALUES (%s, %s)         &quot;&quot;&quot;, (user_id, club_id))      conn.commit()     cur.close()     conn.close()      return redirect(&quot;/club&quot;)   # ============================================================================ # CLUB APPLY # ============================================================================ @app.post(&quot;/club/apply/&lt;int:club_id&gt;&quot;) def club_apply(club_id):     if &quot;user_id&quot; not in session:         return redirect(&quot;/login&quot;)      user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         SELECT membership_id         FROM clubmembership         WHERE student_id=%s AND club_id=%s     &quot;&quot;&quot;, (user_id, club_id))      row = cur.fetchone()      if not row:         cur.execute(&quot;&quot;&quot;             INSERT INTO clubmembership(student_id, club_id, status, joined_date)             VALUES (%s, %s, 'pending', CURRENT_DATE)         &quot;&quot;&quot;, (user_id, club_id))         conn.commit()      cur.close()     conn.close()      return redirect(&quot;/club&quot;)   # ============================================================================ # CLUB CANCEL # ============================================================================ @app.post(&quot;/club/cancel/&lt;int:club_id&gt;&quot;) def club_cancel(club_id):     if &quot;user_id&quot; not in session:         return redirect(&quot;/login&quot;)      user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         DELETE FROM clubmembership         WHERE student_id=%s AND club_id=%s     &quot;&quot;&quot;, (user_id, club_id))      conn.commit()     cur.close()     conn.close()      return redirect(&quot;/club&quot;)   # ============================================================================ # CLUB STATUS # ============================================================================ @app.route(&quot;/club/status&quot;) def club_status():     if &quot;user_id&quot; not in session:         return redirect(&quot;/login&quot;)      user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         SELECT c.club_id, c.name, c.type, c.description,                m.status, m.joined_date         FROM clubmembership m         JOIN club c ON c.club_id = m.club_id         WHERE m.student_id=%s         ORDER BY m.joined_date DESC     &quot;&quot;&quot;, (user_id,))      rows = cur.fetchall()      cur.close()     conn.close()      return render_template(&quot;club_status.html&quot;, rows=rows)   # ============================================================================ # ACTIVITY RECOMMENDATION GENERATE # ============================================================================ @app.route(&quot;/generate-activity-recommendation&quot;) def generate_activity_recommendation():      MBTI_ACTIVITY_PREF = {         &quot;INTJ&quot;: {&quot;세미나&quot;: 5, &quot;워크숍&quot;: 4},         &quot;INTP&quot;: {&quot;세미나&quot;: 5, &quot;워크숍&quot;: 4},         &quot;INFJ&quot;: {&quot;멘토링&quot;: 5, &quot;봉사&quot;: 4, &quot;세미나&quot;: 3},         &quot;INFP&quot;: {&quot;멘토링&quot;: 5, &quot;봉사&quot;: 4},         &quot;ISTJ&quot;: {&quot;공모전&quot;: 5, &quot;워크숍&quot;: 4},         &quot;ISTP&quot;: {&quot;대회&quot;: 5, &quot;체험활동&quot;: 4},         &quot;ISFJ&quot;: {&quot;봉사&quot;: 5, &quot;멘토링&quot;: 4},         &quot;ISFP&quot;: {&quot;봉사&quot;: 5, &quot;체험활동&quot;: 4},         &quot;ENTJ&quot;: {&quot;공모전&quot;: 5, &quot;워크숍&quot;: 4},         &quot;ENTP&quot;: {&quot;대회&quot;: 5, &quot;세미나&quot;: 4},         &quot;ENFJ&quot;: {&quot;멘토링&quot;: 5, &quot;봉사&quot;: 4},         &quot;ENFP&quot;: {&quot;축제&quot;: 5, &quot;봉사&quot;: 4},         &quot;ESTJ&quot;: {&quot;공모전&quot;: 5, &quot;대회&quot;: 4},         &quot;ESTP&quot;: {&quot;대회&quot;: 5, &quot;체험활동&quot;: 4},         &quot;ESFJ&quot;: {&quot;멘토링&quot;: 5, &quot;축제&quot;: 4},         &quot;ESFP&quot;: {&quot;축제&quot;: 5, &quot;체험활동&quot;: 4}     }      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;DELETE FROM ActivityRecommendation&quot;)     cur.execute(&quot;SELECT activity_id, type FROM activity&quot;)     activities = cur.fetchall()      for mbti, pref in MBTI_ACTIVITY_PREF.items():         for act_id, act_type in activities:             rating = pref.get(act_type, 1)             reason = f&quot;{mbti} 유형은 '{act_type}' 활동을 선호합니다.&quot;              cur.execute(&quot;&quot;&quot;                 INSERT INTO ActivityRecommendation (mbti, activity_id, rating, reason)                 VALUES (%s, %s, %s, %s)             &quot;&quot;&quot;, (mbti, act_id, rating, reason))      conn.commit()     cur.close()     conn.close()      return &quot;Activity Recommendation Generated!&quot;   # ============================================================================ # ACTIVITY FAVORITE # ============================================================================ @app.post(&quot;/activity/favorite/&lt;int:activity_id&gt;&quot;) def activity_favorite(activity_id):     user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         SELECT favorite_id         FROM activityfavorite         WHERE student_id=%s AND activity_id=%s     &quot;&quot;&quot;, (user_id, activity_id))     row = cur.fetchone()      if row:         cur.execute(&quot;DELETE FROM activityfavorite WHERE favorite_id=%s&quot;, (row[0],))     else:         cur.execute(&quot;&quot;&quot;             INSERT INTO activityfavorite(student_id, activity_id)             VALUES (%s, %s)         &quot;&quot;&quot;, (user_id, activity_id))      conn.commit()     cur.close()     conn.close()      return redirect(&quot;/activity&quot;)   # ============================================================================ # ACTIVITY APPLY # ============================================================================ @app.post(&quot;/activity/apply/&lt;int:activity_id&gt;&quot;) def activity_apply(activity_id):     user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         INSERT INTO activityparticipation (student_id, activity_id, status, registered_at)         VALUES (%s, %s, 'pending', NOW())         ON CONFLICT (student_id, activity_id)         DO UPDATE SET status='pending', registered_at=NOW()     &quot;&quot;&quot;, (user_id, activity_id))      conn.commit()     cur.close()     conn.close()      return redirect(&quot;/activity&quot;)   # ============================================================================ # ACTIVITY CANCEL # ============================================================================ @app.post(&quot;/activity/cancel/&lt;int:activity_id&gt;&quot;) def activity_cancel(activity_id):     user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      cur.execute(&quot;&quot;&quot;         UPDATE activityparticipation         SET status='canceled'         WHERE student_id=%s AND activity_id=%s     &quot;&quot;&quot;, (user_id, activity_id))      cur.execute(&quot;&quot;&quot;         UPDATE activity         SET current_participants = current_participants - 1         WHERE activity_id=%s AND current_participants &gt; 0     &quot;&quot;&quot;, (activity_id,))      conn.commit()     cur.close()     conn.close()      return redirect(&quot;/activity&quot;)   # ============================================================================ # ACTIVITY PAGE # ============================================================================ @app.template_filter(&quot;stars&quot;) def stars_filter(rating):     rating = int(rating)     return &quot;★&quot; * rating + &quot;☆&quot; * (5 - rating)   @app.route(&quot;/activity&quot;) def activity_page():     if &quot;user_id&quot; not in session:         return redirect(&quot;/login&quot;)      user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      # 학생 MBTI     cur.execute(&quot;SELECT mbti FROM student WHERE student_id=%s&quot;, (user_id,))     mbti = cur.fetchone()[0]      # 추천된 Activity 가져오기     cur.execute(&quot;&quot;&quot;         SELECT a.activity_id, a.name, a.type, a.description,                a.start_date, a.end_date,                a.max_participants, a.current_participants,                COALESCE(r.rating, 0), r.reason         FROM activity a         LEFT JOIN ActivityRecommendation r             ON r.activity_id = a.activity_id AND r.mbti = %s         ORDER BY rating DESC, start_date ASC     &quot;&quot;&quot;, (mbti,))     activities = cur.fetchall()      top3 = activities[:3]      # 찜 목록     cur.execute(&quot;SELECT activity_id FROM activityfavorite WHERE student_id=%s&quot;, (user_id,))     liked = {row[0] for row in cur.fetchall()}      # 지원 목록     cur.execute(&quot;&quot;&quot;         SELECT activity_id, status         FROM activityparticipation         WHERE student_id=%s     &quot;&quot;&quot;, (user_id,))     applied = {row[0]: row[1] for row in cur.fetchall()}      cur.close()     conn.close()      return render_template(         &quot;activity.html&quot;,         activities=activities,         top3=top3,         liked=liked,         applied=applied     )   # ============================================================================ # PROFILE PAGE # ============================================================================ @app.route(&quot;/profile&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;]) def profile_page():     if &quot;user_id&quot; not in session:         return redirect(&quot;/login&quot;)      user_id = session[&quot;user_id&quot;]      conn = get_connection()     cur = conn.cursor()      # -----------------------------------------------------     # POST: 저장하기     # -----------------------------------------------------     if request.method == &quot;POST&quot;:         nickname = request.form.get(&quot;nickname&quot;)         mbti = request.form.get(&quot;mbti&quot;)         major_id = request.form.get(&quot;major_id&quot;)         year_level = request.form.get(&quot;year_level&quot;)          cur.execute(&quot;&quot;&quot;             UPDATE Student             SET nickname=%s,                 mbti=%s,                 major_id=%s,                 year_level=%s,                 updated_at=NOW()             WHERE student_id=%s         &quot;&quot;&quot;, (nickname, mbti, major_id, year_level, user_id))          conn.commit()         cur.close()         conn.close()          return redirect(&quot;/profile&quot;)      # -----------------------------------------------------     # GET: Student 정보     # -----------------------------------------------------     cur.execute(&quot;&quot;&quot;         SELECT nickname, mbti, major_id, year_level         FROM Student         WHERE student_id=%s     &quot;&quot;&quot;, (user_id,))     nickname, mbti, major_id, year_level = cur.fetchone()      # Major 리스트     cur.execute(&quot;SELECT major_id, major_name FROM major ORDER BY major_name&quot;)     major_list = cur.fetchall()      cur.close()     conn.close()      year_list = [1, 2, 3, 4]      return render_template(         &quot;profile.html&quot;,         nickname=nickname,         mbti=mbti,         major_id=major_id,         year_level=year_level,         major_list=major_list,         year_list=year_list     )   # ============================================================================ # LOGOUT # ============================================================================ @app.route(&quot;/logout&quot;) def logout():     session.clear()     return redirect(&quot;/login&quot;)   # ============================================================================ # MAIN # ============================================================================ if __name__ == &quot;__main__&quot;:     app.run(debug=True) " />
    </option>
  </component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-python-sdk-4e2b1448bda8-9a97661f3031-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-252.27397.106" />
      </set>
    </attachedChunks>
  </component>
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="ebf40ef6-dba9-436a-9599-74b1c3db166c" name="Changes" comment="" />
      <created>1763360347615</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1763360347615</updated>
      <workItem from="1763360348736" duration="3966000" />
      <workItem from="1764028335454" duration="18000" />
      <workItem from="1764519903155" duration="2566000" />
      <workItem from="1764526112114" duration="9004000" />
      <workItem from="1764652713159" duration="2227000" />
      <workItem from="1764779188465" duration="659000" />
      <workItem from="1764780589246" duration="30251000" />
      <workItem from="1764987375179" duration="3765000" />
      <workItem from="1765044685279" duration="54000" />
    </task>
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
  <component name="com.intellij.coverage.CoverageDataManagerImpl">
    <SUITE FILE_PATH="coverage/mbti_project$app.coverage" NAME="app Coverage Results" MODIFIED="1764520359940" SOURCE_PROVIDER="com.intellij.coverage.DefaultCoverageFileProvider" RUNNER="coverage.py" COVERAGE_BY_TEST_ENABLED="false" COVERAGE_TRACING_ENABLED="false" WORKING_DIRECTORY="$PROJECT_DIR$" />
  </component>
</project>