{% extends "base.html" %}
{% block content %}

<!-- ======= ì‹œê°„í‘œ ìƒì„±í•˜ê¸° ë²„íŠ¼ (ë§¨ ìœ„) ======= -->
<div style="text-align:right; margin-bottom:25px;">
    <a href="/generate-timetable" class="btn"
       style="padding:12px 22px; font-size:18px; background:#4a64ff; color:white; border-radius:10px;">
        ğŸ“… ì‹œê°„í‘œ ìë™ ìƒì„±í•˜ê¸°
    </a>
</div>

<!-- Tabs -->
<div class="tabs">
    <div class="tab active" id="tab-major" onclick="showSection('major')">ì „ê³µ ì¶”ì²œ</div>
    <div class="tab" id="tab-minor" onclick="showSection('minor')">ë¶€ì „ê³µ ì¶”ì²œ</div>
    <div class="tab" id="tab-like" onclick="showSection('like')">ì°œí•œ ê°•ì˜</div>
</div>

<script>
function showSection(name) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');

    document.getElementById('tab-' + name).classList.add('active');
    document.getElementById('section-' + name).style.display = 'block';
}
document.addEventListener("DOMContentLoaded", () => showSection("major"));
</script>


<!-- ========================= ì „ê³µ ì¶”ì²œ ========================= -->
<div class="section" id="section-major">

    <h2 class="section-title">ì „ê³µ ì¶”ì²œ ê°•ì˜</h2>

    {% for cat, items in major_by_year.items() %}
        <h3 style="margin-bottom:10px;">{{ cat }} ê³¼ëª©</h3>

        <div class="card-grid">
        {% for c in items %}
            {% set stars = (c.score|int // 20) %}
            {% set score = stars if stars > 0 else 1 %}

            <div class="card card-small">

                <!-- â­ ë³„ ì¶œë ¥ (5ê°œ ê³ ì •) -->
                <div class="star-score">
                    {% for i in range(1, 6) %}
                        {% if i <= score %}â˜…
                        {% else %}<span style="color:#ddd;">â˜…</span>
                        {% endif %}
                    {% endfor %}
                </div>

                <div class="category-tag">ì „ê³µ Â· {{ cat }}</div>

                <h3>{{ c.name }}</h3>
                <p>{{ c.day }} | {{ c.start }} ~ {{ c.end }}</p>
                <p style="margin-top:6px;">{{ c.description }}</p>

                <form method="post" action="/toggle-like">
                    <input type="hidden" name="lecture_id" value="{{ c.lecture_id }}">
                    <button class="btn-outline" style="margin-top:10px;">â™¡ ì°œí•˜ê¸°</button>
                </form>
            </div>
        {% endfor %}
        </div>
    {% endfor %}
</div>


<!-- ========================= ë¶€ì „ê³µ ì¶”ì²œ ========================= -->
<div class="section" id="section-minor" style="display:none;">

    <h2 class="section-title">ë¶€ì „ê³µ ì¶”ì²œ ê°•ì˜</h2>

    {% for minor_name, items in minor_filtered.items() %}
        {% if items|length > 0 %}
        <h3 style="margin-bottom:10px;">{{ minor_name }}</h3>

        <div class="card-grid">
        {% for c in items %}
            {% set stars = (c.score|int // 20) %}
            {% set score = stars if stars > 0 else 1 %}

            <div class="card card-small">
                <div class="star-score">
                    {% for i in range(1, 6) %}
                        {% if i <= score %}â˜…
                        {% else %}<span style="color:#ddd;">â˜…</span>
                        {% endif %}
                    {% endfor %}
                </div>

                <div class="minor-tag">ë¶€ì „ê³µ Â· {{ minor_name }}</div>

                <h3>{{ c.name }}</h3>
                <p>{{ c.day }} | {{ c.start }} ~ {{ c.end }}</p>
                <p style="margin-top:6px;">{{ c.description }}</p>

                <form method="post" action="/toggle-like">
                    <input type="hidden" name="lecture_id" value="{{ c.lecture_id }}">
                    <button class="btn-outline" style="margin-top:10px;">â™¡ ì°œí•˜ê¸°</button>
                </form>
            </div>
        {% endfor %}
        </div>
        {% endif %}
    {% endfor %}
</div>


<!-- ========================= ì°œí•œ ê°•ì˜ ========================= -->
<div class="section" id="section-like" style="display:none;">

    <h2 class="section-title">ë‚´ê°€ ì°œí•œ ê°•ì˜</h2>

    <div class="card-grid">
    {% for c in liked_courses %}
        {% set stars = (c.score|int // 20) %}
        {% set score = stars if stars > 0 else 1 %}

        <div class="card card-small">
            <div class="star-score">
                {% for i in range(1, 6) %}
                    {% if i <= score %}â˜…
                    {% else %}<span style="color:#ddd;">â˜…</span>
                    {% endif %}
                {% endfor %}
            </div>

            <h3>{{ c.name }}</h3>
            <p>{{ c.day }} | {{ c.start }} ~ {{ c.end }}</p>
            <p style="margin-top:6px;">{{ c.description }}</p>

            <form method="post" action="/toggle-like">
                <input type="hidden" name="lecture_id" value="{{ c.lecture_id }}">
                <button class="btn-outline" style="margin-top:10px;">â™¡ ì°œ í•´ì œ</button>
            </form>
        </div>
    {% endfor %}
    </div>

</div>

{% endblock %}
