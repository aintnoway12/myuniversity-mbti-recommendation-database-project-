{% extends "base.html" %}
{% block content %}

<style>
    .tabs { display: flex; gap: 40px; margin-bottom: 25px; font-size: 22px; font-weight: 700; }
    .tab { color: #777; cursor: pointer; text-decoration: none; }
    .active { color:#4a64ff; border-bottom: 3px solid #4a64ff; padding-bottom:3px; }

    .card-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; }
    .card {
        background:white; border-radius:14px; padding:20px;
        box-shadow:0 4px 15px rgba(0,0,0,0.08);
    }

    .star { color:#ffb400; font-size:20px; }

    .btn { background:#4a64ff; color:white; border:none; padding:10px; border-radius:8px; width:100%; margin-top:10px; cursor:pointer; }
    .btn-outline { background:white; border:2px solid #4a64ff; padding:10px; border-radius:8px; width:100%; color:#4a64ff; margin-top:10px; cursor:pointer; }
    .btn-gray { background:#ddd; color:#555; border:none; padding:10px; border-radius:8px; width:100%; margin-top:10px; cursor:default; }
</style>

<!-- ========================= -->
<!--        TAB MENU           -->
<!-- ========================= -->
<div class="tabs">
    <a href="/club?view=all" class="tab {% if view=='all' %}active{% endif %}">ì „ì²´ ë™ì•„ë¦¬</a>
    <a href="/club?view=liked" class="tab {% if view=='liked' %}active{% endif %}">ì°œí•œ ë™ì•„ë¦¬</a>
    <a href="/club?view=applied" class="tab {% if view=='applied' %}active{% endif %}">ì§€ì›í•œ ë™ì•„ë¦¬</a>
</div>

<!-- ========================= -->
<!--        CLUB CARDS         -->
<!-- ========================= -->
<div class="card-grid">

{% for c in clubs %}
    <div class="card">

        <h3>{{ c.name }}</h3>

        <p style="color:#555;">ìœ í˜•: {{ c.type }}</p>
        <p style="color:#555;">í™œë™ ë¹ˆë„: {{ c.frequency }}</p>
        <p>ì •ì›: {{ c.current }}/{{ c.max }}</p>

        <p>{{ c.description }}</p>

        <!-- â­ MBTI ì¶”ì²œ ì ìˆ˜ (0 ë˜ëŠ” None â†’ 1ì  ë³´ì •) -->
        {% set score = c.rating if c.rating and c.rating > 0 else 1 %}

        <!-- â­ 5ê°œ ê³ ì • ë³„ í‘œì‹œ -->
        <div style="margin:10px 0; font-size:20px;">
            {% for i in range(1, 6) %}
                {% if i <= score %}
                    <span class="star">â˜…</span>
                {% else %}
                    <span class="star" style="color:#ddd;">â˜…</span>
                {% endif %}
            {% endfor %}
        </div>

        <!-- âœ¨ ì¶”ì²œ ì„¤ëª… -->
        <p style="font-size:14px; color:#777;">
            {{ c.reason if c.reason else "ì¶”ì²œ ì´ìœ  ì—†ìŒ" }}
        </p>

        <!-- ì°œí•˜ê¸° -->
        <form method="POST" action="/club/favorite/{{ c.club_id }}">
            {% if c.club_id in liked_clubs %}
                <button class="btn-gray">â™¥ ì°œ ì·¨ì†Œ</button>
            {% else %}
                <button class="btn-outline">â™¡ ì°œí•˜ê¸°</button>
            {% endif %}
        </form>

        <!-- ì§€ì› ìƒíƒœ í‘œì‹œ -->
        {% if c.club_id in applied %}
            {% set status = applied[c.club_id] %}

            {% if status == 'pending' %}
                <button class="btn-gray">ëŒ€ê¸° ì¤‘</button>
                <form method="POST" action="/club/cancel/{{ c.club_id }}">
                    <button class="btn-outline">ì§€ì› ì·¨ì†Œ</button>
                </form>

            {% elif status == 'approved' %}
                <button class="btn-gray">ìŠ¹ì¸ë¨</button>

            {% elif status == 'rejected' %}
                <button class="btn-gray">ê±°ì ˆë¨</button>
            {% endif %}

        {% else %}
            <form method="POST" action="/club/apply/{{ c.club_id }}">
                <button class="btn">ğŸ“© ì§€ì›í•˜ê¸°</button>
            </form>
        {% endif %}

    </div>
{% endfor %}

</div>

{% endblock %}
